<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>COVID Dash</title>
<style>
.table {
    font-family: monospace;
    white-space: pre;
}
</style>

</head>
<body>
    <div class="table"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.min.js"></script>
<script>
const table = document.querySelector('.table');

const loadDsv = async (url, separator) => {
    const result = await fetch(url);
    const dsvText = await result.text();
    return dsvText.split('\n').slice(1).map(line => line.split(separator));
};

(async () => {
    const covidRows = await loadDsv("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv", ',');

    table.innerHTML = JSON.stringify(covidRows, null, 2);
    const byDay = _.groupBy(covidRows, row => row[0]);
    console.log(byDay)

    const populationRows = await loadDsv("us-states-population-april-1-2020.tsv", "\t");
    let populations = {};
    populationRows.forEach(([name, pop]) => {
        populations[name] = +pop.split(',').join('');
    });
    console.log(populations)
})();

</script>
</body>
</html>